# API Expert - Mental Model
#
# This file represents the agent's understanding of API patterns.
# Populated with AgileFlow-specific CLI architecture knowledge.
#
# NOT a source of truth - always validate against actual code.

domain: api
last_updated: 2025-12-21
version: 1.1

# AgileFlow CLI architecture (not a web API - it's a Node.js CLI tool)
files:
  cli_entry:
    - path: packages/cli/tools/agileflow-npx.js
      purpose: Main CLI entry point (npx agileflow)
      role: "Routes to agileflow-cli.js for command execution"
    - path: packages/cli/tools/cli/agileflow-cli.js
      purpose: Command router using Commander.js
      pattern: "Dynamically loads commands from commands/ directory"

  commands:
    - path: packages/cli/tools/cli/commands/
      purpose: CLI command implementations
      pattern: "<command>.js exports {name, description, options, action}"
      examples:
        - "setup.js - Interactive installation wizard"
        - "status.js - Show installation status"
        - "doctor.js - Diagnose and auto-fix issues"
        - "list.js - List installed components"
        - "update.js - Update AgileFlow version"
        - "uninstall.js - Remove AgileFlow"
        - "config.js - Manage configuration"

  lib_utilities:
    - path: packages/cli/tools/cli/lib/ui.js
      purpose: CLI UI utilities (logo, prompts, colors)
      exports: [displayLogo, displaySection, success, warning, error, info, promptInstall, confirm]
    - path: packages/cli/tools/cli/lib/version-checker.js
      purpose: npm version checking for updates
      exports: [checkForUpdate, getCurrentVersion]
    - path: packages/cli/tools/cli/lib/content-injector.js
      purpose: Dynamic placeholder replacement (agent lists, command lists)
    - path: packages/cli/tools/cli/lib/docs-setup.js
      purpose: Documentation structure creation
    - path: packages/cli/tools/cli/lib/npm-utils.js
      purpose: npm package utilities

  installers:
    - path: packages/cli/tools/cli/installers/core/installer.js
      purpose: Core installation logic (Installer class)
      key_methods: [install, getStatus, countInstalledItems]
    - path: packages/cli/tools/cli/installers/ide/
      purpose: IDE-specific installers (Claude Code, Cursor, Windsurf)

relationships:
  - name: command_structure
    pattern: "Each command exports {name, description, options, action}"
    loader: "agileflow-cli.js dynamically loads from commands/"

  - name: ui_consistency
    lib: "lib/ui.js"
    usage: "All commands use same displayLogo, success, warning, error functions"

  - name: installer_flow
    entry: "setup.js"
    core: "installers/core/installer.js"
    ide: "installers/ide/manager.js"

patterns:
  - name: Commander.js CLI
    description: "Commands defined as objects with name, description, options, action"
    library: "commander"
    pattern: "program.command(name).description(...).option(...).action(...)"

  - name: Async Actions
    description: "All command actions are async functions"
    pattern: "action: async (options) => { ... }"

  - name: Error Handling
    description: "Try-catch with chalk.red error display"
    pattern: "try { ... } catch (err) { console.error(chalk.red('Error:'), err.message) }"

  - name: Spinner Progress
    description: "ora spinners for long operations"
    library: "ora"
    pattern: "const spinner = ora('...').start(); ... spinner.stop();"

  - name: Dynamic Loading
    description: "Commands dynamically loaded from directory"
    location: "agileflow-cli.js"
    pattern: "fs.readdirSync(commandsPath).filter(f => f.endsWith('.js'))"

conventions:
  - "Commands export {name, description, options, action}"
  - "Use chalk for colored output (green=success, yellow=warning, red=error)"
  - "Use ora spinners for async operations"
  - "Use inquirer for interactive prompts"
  - "All actions are async functions"
  - "Exit with process.exit(0) on success, process.exit(1) on error"
  - "Support --directory option for project path"
  - "Use fs-extra for filesystem operations"

# Learned from AgileFlow codebase exploration
learnings:
  - date: 2025-12-21
    context: "Analyzed AgileFlow CLI architecture"
    insight: "AgileFlow is a Node.js CLI tool using Commander.js, not a REST API"
    source: "packages/cli/tools/"

  - date: 2025-12-21
    context: "Analyzed command structure"
    insight: "7 CLI commands (setup, status, doctor, list, update, uninstall, config) dynamically loaded"
    source: "packages/cli/tools/cli/commands/"

  - date: 2025-12-21
    context: "Analyzed lib utilities"
    insight: "Shared UI utilities (ui.js), version checking (version-checker.js), content injection (content-injector.js)"
    source: "packages/cli/tools/cli/lib/"

  - date: 2025-12-21
    context: "Analyzed installer pattern"
    insight: "Core Installer class with install, getStatus, countInstalledItems methods; IDE-specific installers for Claude/Cursor/Windsurf"
    source: "packages/cli/tools/cli/installers/"
