domain: refactor
last_updated: 2025-12-21
version: 1.1

# AgileFlow codebase patterns for refactoring
files:
  cli_structure:
    - path: packages/cli/tools/cli/commands/
      purpose: CLI command implementations
      pattern: "Each command is self-contained .js file"
      observation: "Good separation of concerns"

    - path: packages/cli/tools/cli/lib/
      purpose: Shared utilities
      files:
        - "ui.js - Display utilities (logo, colors, prompts)"
        - "version-checker.js - npm version checking"
        - "content-injector.js - Placeholder replacement"
        - "docs-setup.js - Documentation scaffolding"
        - "npm-utils.js - npm package utilities"

    - path: packages/cli/tools/cli/installers/
      purpose: Installation logic
      pattern: "core/ for main logic, ide/ for IDE-specific"

  core_content:
    - path: packages/cli/src/core/commands/
      purpose: Slash command markdown files
      count: 41
      pattern: "<command>.md with frontmatter"

    - path: packages/cli/src/core/agents/
      purpose: Agent prompt markdown files
      count: 26
      pattern: "<agent>.md with frontmatter (name, description, tools, model)"

    - path: packages/cli/src/core/experts/
      purpose: Expert knowledge files
      count: 25
      pattern: "<domain>/expertise.yaml, question.md, self-improve.md, workflow.md"

    - path: packages/cli/src/core/skills/
      purpose: Auto-activating skills
      count: 23
      pattern: "<skill>/SKILL.md"

  scripts:
    - path: scripts/
      purpose: Utility shell scripts
      count: 12+
      examples:
        - "release.sh - Automated release"
        - "validate-expertise.sh - Expert validation"
        - "expertise-metrics.sh - Metrics dashboard"
        - "archive-completed-stories.sh - Story archival"

relationships:
  - name: command_pattern
    location: "packages/cli/tools/cli/commands/"
    pattern: "exports {name, description, options, action}"
    refactor_opportunity: "Consider TypeScript for type safety"

  - name: lib_utilities
    location: "packages/cli/tools/cli/lib/"
    pattern: "Shared modules with explicit exports"
    observation: "Well-organized, minimal duplication"

  - name: content_structure
    locations:
      - "commands/ - 41 .md files"
      - "agents/ - 26 .md files"
      - "experts/ - 25 directories"
      - "skills/ - 23 directories"
    observation: "Consistent patterns across all content types"

patterns:
  - name: Dynamic Content Injection
    description: "Placeholders replaced at install time"
    location: "lib/content-injector.js"
    placeholders:
      - "<!-- {{AGENT_LIST}} -->"
      - "<!-- {{COMMAND_LIST}} -->"
    benefit: "Zero maintenance for lists"

  - name: IDE-Specific Installers
    description: "Separate installer per IDE"
    location: "installers/ide/"
    ides: ["claude-code", "cursor", "windsurf"]
    benefit: "Easy to add new IDEs"

  - name: Frontmatter Metadata
    description: "YAML frontmatter in markdown files"
    used_in: ["commands", "agents", "skills"]
    fields: ["name", "description", "tools", "model"]

  - name: Shell Script Automation
    description: "Bash scripts for common operations"
    location: "scripts/"
    pattern: "Colored output, clear usage instructions"

conventions:
  - "CLI commands use Commander.js with async actions"
  - "Shared utilities in lib/ with clear exports"
  - "Content files use markdown with YAML frontmatter"
  - "Shell scripts in scripts/ with colored output"
  - "Dynamic content injection for lists"
  - "IDE installers are pluggable"
  - "Monorepo structure: packages/cli/ contains npm package"

# Learned from AgileFlow codebase exploration
learnings:
  - date: 2025-12-21
    context: "Analyzed CLI code organization"
    insight: "Well-structured with commands/, lib/, installers/ separation; each command is self-contained"
    source: "packages/cli/tools/cli/"

  - date: 2025-12-21
    context: "Analyzed content structure"
    insight: "Consistent patterns: 41 commands, 26 agents, 25 experts, 23 skills - all use frontmatter markdown"
    source: "packages/cli/src/core/"

  - date: 2025-12-21
    context: "Analyzed dynamic content injection"
    insight: "content-injector.js replaces placeholders like {{AGENT_LIST}} at install time - zero maintenance"
    source: "packages/cli/tools/cli/lib/content-injector.js"

  - date: 2025-12-21
    context: "Analyzed refactoring opportunities"
    insight: "Code is well-organized; potential improvements: TypeScript migration, unit tests, linting"
    source: "packages/cli/"
