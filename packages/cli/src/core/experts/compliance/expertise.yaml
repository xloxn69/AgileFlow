# Compliance Expert - Domain Knowledge
# This file is the agent's "mental model" of the compliance domain
# AUTO-UPDATED by self-improve.md after completing work

domain: compliance
last_updated: 2025-12-21
version: 1.1

files:
  policies:
    - path: docs/compliance/
      purpose: "Compliance documentation"
      conventions: "One document per regulation"
    - path: docs/compliance/gdpr.md
      purpose: "GDPR compliance documentation"
    - path: docs/compliance/privacy-policy.md
      purpose: "Privacy policy document"
    - path: docs/compliance/data-retention.md
      purpose: "Data retention policies"

  audit:
    - path: src/audit/
      purpose: "Audit trail implementation"
      conventions: "Immutable audit logs"
    - path: src/audit/logger.ts
      purpose: "Audit event logging"
    - path: docs/compliance/audit-events.md
      purpose: "Documented audit events"

  consent:
    - path: src/consent/
      purpose: "Consent management implementation"
      conventions: "GDPR-compliant consent flows"
    - path: docs/compliance/consent-matrix.md
      purpose: "What data requires what consent"

  security:
    - path: docs/compliance/security-controls.md
      purpose: "Security control documentation"

relationships:
  - parent: regulations
    child: policies
    type: implements
    notes: "Policies implement regulatory requirements"
  - parent: audit_events
    child: audit_logs
    type: produces
    notes: "Events produce immutable audit logs"
  - parent: consent
    child: data_processing
    type: gates
    notes: "Consent gates data processing activities"

patterns:
  - name: Audit Trail Pattern
    description: "Immutable log of all data access and changes"
    location: src/audit/
    example: |
      {
        event: "user_data_accessed",
        actor: "user-123",
        target: "user-456",
        timestamp: "2025-12-16T10:00:00Z"
      }

  - name: Consent Management
    description: "Explicit opt-in consent with withdrawal capability"
    location: src/consent/
    example: "hasConsent('analytics') ? track(event) : skip()"

  - name: Data Retention
    description: "Automated deletion after retention period"
    location: docs/compliance/data-retention.md
    example: "User data: 2 years, Audit logs: 7 years"

  - name: Right to Be Forgotten
    description: "Complete user data deletion on request"
    location: src/consent/
    example: "DELETE FROM users WHERE id = ? cascade"

conventions:
  - "All PII access must be audit logged"
  - "Explicit consent required before data processing"
  - "Data retention periods must be documented"
  - "Right to access and deletion must be supported"
  - "Breach notification procedures documented"
  - "Compliance cannot be compromised for convenience"
  - "Annual compliance audits required"

regulations:
  gdpr:
    scope: "EU personal data"
    requirements:
      - "Explicit consent for processing"
      - "Right to access, rectification, deletion"
      - "Data portability"
      - "72-hour breach notification"
      - "Data Protection Impact Assessment"

  ccpa:
    scope: "California residents"
    requirements:
      - "Right to know what data collected"
      - "Right to deletion"
      - "Right to opt-out of sale"
      - "Non-discrimination"

  hipaa:
    scope: "Protected Health Information (PHI)"
    requirements:
      - "Access controls"
      - "Audit trails"
      - "Encryption"
      - "Business Associate Agreements"

  soc2:
    scope: "Service organizations"
    requirements:
      - "Security controls"
      - "Availability"
      - "Processing integrity"
      - "Confidentiality"
      - "Privacy"

  pci_dss:
    scope: "Payment card data"
    requirements:
      - "Network security"
      - "Cardholder data protection"
      - "Vulnerability management"
      - "Access control"
      - "Monitoring and testing"

# Learnings are AUTO-UPDATED by self-improve.md
learnings:
  - date: 2025-12-21
    context: AgileFlow commit policy
    learning: |
      NO AI attribution in commits. CLAUDE.md explicitly forbids AI footers,
      Co-Authored-By for AI, emoji robots, or any AI mentions in commit messages.
      Commits must be clean conventional format (feat/fix/chore/docs).
      This is a compliance requirement to maintain professional git history.

  - date: 2025-12-21
    context: AgileFlow secrets management
    learning: |
      Gitignored sensitive files include: .npmrc (npm token), .mcp.json (MCP secrets),
      and CLAUDE.md (internal dev docs). NPM_TOKEN is stored in GitHub Secrets at
      https://github.com/projectquestorg/AgileFlow/settings/secrets/actions and NEVER
      committed to repository. This follows security best practices for credential storage.

  - date: 2025-12-21
    context: AgileFlow audit trail
    learning: |
      ADRs in docs/03-decisions/ document architecture decisions for audit trails.
      status.json in docs/09-agents/ provides complete story tracking history with
      timestamps, status changes, and agent communications. This creates immutable
      audit trail of all project decisions and work progress.

  - date: 2025-12-21
    context: AgileFlow data retention
    learning: |
      Auto-archival system (scripts/archive-completed-stories.sh) automatically moves
      completed stories older than 7 days to docs/09-agents/archive/YYYY-MM.json.
      This implements data retention policy while keeping status.json lean. Archives
      organized by month for compliance audits and historical retrieval.
