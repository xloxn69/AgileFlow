domain: performance
last_updated: 2025-12-21
version: 1.1

files:
  benchmarks:
    - path: benchmarks/
      purpose: Performance benchmark files
    - path: tests/performance/
      purpose: Performance tests

  profiling:
    - path: .clinic/
      purpose: Node.js profiling output
    - path: profiles/
      purpose: CPU/memory profiles

  config:
    - path: lighthouse.config.js
      purpose: Lighthouse performance config
    - path: webpack.config.js
      purpose: Bundle optimization config

relationships:
  - metric_type: api_response_time
    target: "<200ms p95"
    measurement: "Load testing, APM"
  - metric_type: page_load
    target: "<3s LCP"
    measurement: "Lighthouse, Core Web Vitals"
  - metric_type: bundle_size
    target: "<250KB gzipped"
    measurement: "Webpack analyzer"
  - metric_type: database_query
    target: "<50ms p95"
    measurement: "Query profiling"

patterns:
  - name: N+1 Query Fix
    description: "Batch queries instead of loop"
    detection: "Multiple similar queries in sequence"
  - name: Caching Layer
    description: "Cache expensive computations"
    types: [memory, redis, cdn]
  - name: Lazy Loading
    description: "Load resources on demand"
    applies_to: [images, modules, routes]
  - name: Database Indexing
    description: "Add indexes for slow queries"
    detection: "EXPLAIN shows table scan"

conventions:
  - "Profile before optimizing (no premature optimization)"
  - "Measure before and after every change"
  - "Set performance budgets in CI"
  - "Document performance trade-offs"
  - "Monitor production performance continuously"
  - "Alert on performance regressions"

bottlenecks:
  common:
    - "Unindexed database queries"
    - "N+1 query patterns"
    - "Large bundle sizes"
    - "Unoptimized images"
    - "Missing caching"
    - "Synchronous operations"

learnings:
  - date: 2025-12-21
    context: "AgileFlow status.json management"
    learning: "Auto-archival system keeps status.json lean by moving completed stories >7 days old to monthly archives (docs/09-agents/archive/YYYY-MM.json). This prevents file bloat and improves agent processing speed. Configured in docs/00-meta/agileflow-metadata.json with threshold_days: 7."
    impact: "Maintains fast status.json parsing even in long-running projects"

  - date: 2025-12-21
    context: "AgileFlow status.json compression"
    learning: "/agileflow:compress command removes verbose fields (user_stories.*.description, user_stories.*.acceptance_criteria) from status.json. Use when file grows too large. Original data preserved in story files under docs/06-stories/."
    impact: "Reduces status.json size by 60-80% when needed"

  - date: 2025-12-21
    context: "AgileFlow installation performance"
    learning: "Dynamic content injection happens at install time, not runtime. Placeholders like {{AGENT_LIST}} in source files get replaced during 'npx agileflow setup'. This means zero runtime overhead - installed files are pre-rendered with current lists."
    impact: "No template parsing overhead during Claude Code sessions"

  - date: 2025-12-21
    context: "AgileFlow expertise file sizing"
    learning: "Keep expertise.yaml files under 200 lines each. Large expertise files slow down expert initialization. Split domains into focused experts (e.g., performance, security, architecture) rather than one monolithic file."
    impact: "Faster expert loading, better maintainability"

  - date: 2025-12-21
    context: "AgileFlow agent model selection"
    learning: "Most AgileFlow agents use Haiku model (not Opus/Sonnet) for cost-effectiveness and speed. Haiku is sufficient for focused tasks like status updates, story tracking, git operations. Reserve Opus for complex reasoning tasks."
    impact: "90% cost reduction on routine agent operations while maintaining quality"
