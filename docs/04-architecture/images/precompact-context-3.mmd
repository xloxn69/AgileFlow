flowchart LR
    subgraph Input
        STATE[(session-state.json)]
        CMD1[babysit.md]
        CMD2[epic.md]
    end

    subgraph Process["precompact-context.sh"]
        READ[Read active_commands] --> LOOP{For each command}
        LOOP --> FIND[Find command file]
        FIND --> EXTRACT[Extract COMPACT_SUMMARY]
        EXTRACT --> APPEND[Append to output]
        APPEND --> LOOP
    end

    subgraph Output
        CTX["Preserved Context<br/>with all summaries"]
    end

    STATE --> READ
    CMD1 --> FIND
    CMD2 --> FIND
    APPEND --> CTX
