---
title: Configuration
description: Complete guide to AgileFlow's configuration system - 9 agents for customizing your development workflow
---

# Configuration System

AgileFlow's configuration system provides 9 specialized agents that set up, customize, and verify every aspect of your development workflow. Access them through `/agileflow:configure`.

## Quick Start

```bash
# Interactive wizard - guides you through all options
/agileflow:configure

# Detect current configuration
/agileflow:configure --detect

# Enable specific features
/agileflow:configure --enable=damage-control,status-line,archival

# Upgrade to latest versions
/agileflow:configure --upgrade
```

## The 9 Configuration Agents

| Agent | Purpose | Key Feature |
|-------|---------|-------------|
| **git-config** | Initialize git and remote repos | SSH/HTTPS support |
| **hooks** | Event-driven automation | SessionStart, PreCompact, Stop |
| **precompact** | Context preservation | Survives conversation compression |
| **status-line** | Custom status bar | Story, WIP, context display |
| **archival** | Auto-manage status.json | Threshold-based cleanup |
| **attribution** | Git commit policy | Control AI disclosure |
| **ci** | CI/CD workflows | GitHub Actions, GitLab, CircleCI |
| **damage-control** | Destructive command protection | Pattern-based blocking |
| **verify** | Test configurations | Token management |

## Recommended Setup Order

```
Phase 1: Foundation (10-15 min)
â”œâ”€ 1. git-config      â†’ Enable version control
â”œâ”€ 2. hooks           â†’ Enable automation
â””â”€ 3. attribution     â†’ Establish commit policy

Phase 2: Safety (5-10 min)
â”œâ”€ 4. damage-control  â†’ Protect codebase
â””â”€ 5. verify          â†’ Validate setup

Phase 3: Productivity (15-20 min)
â”œâ”€ 6. archival        â†’ Manage status.json size
â”œâ”€ 7. status-line     â†’ Real-time visibility
â”œâ”€ 8. ci              â†’ Automated testing
â””â”€ 9. precompact      â†’ Long conversation support
```

---

## Agent Details

### 1. Git Configuration

**Purpose:** Initialize git repository and connect to remote (GitHub, GitLab, etc.)

**What it does:**
- Initializes git repository if needed
- Configures remote URL (SSH or HTTPS)
- Verifies remote connection
- Stores configuration in metadata

**Options:**
```
Initialize git:      Yes / No
Remote protocol:     SSH / HTTPS
Private repo:        Yes / No (for auth)
Verify connection:   Yes / No
```

**Files modified:**
- `.git/` - Git repository
- `docs/00-meta/agileflow-metadata.json` - Git config stored
- `.claude/settings.local.json` - Tokens (if needed)

---

### 2. Hooks System

**Purpose:** Enable event-driven automation through Claude Code's hooks

**Available hooks:**
- **SessionStart** - Welcome info when Claude Code starts
- **PreCompact** - Preserve context before compression
- **Stop** - Session summary when Claude stops
- **UserPromptSubmit** - Activity logging

**Options:**
```
SessionStart:        Enable / Disable
PreCompact:          Enable / Disable
Stop:                Enable / Disable
UserPromptSubmit:    Enable / Disable
```

**Files created:**
- `.claude/settings.json` - Hook configuration
- `scripts/agileflow-welcome.js` - SessionStart script
- `scripts/precompact-context.sh` - PreCompact script
- `scripts/agileflow-stop.sh` - Stop hook script

**Important:** Requires Claude Code restart for hooks to take effect.

---

### 3. PreCompact Configuration

**Purpose:** Preserve critical project context when Claude Code compacts conversations

**Benefits:**
- Project conventions survive compression
- Active command rules preserved
- Current story and WIP status maintained
- Team conventions don't get lost

**Example output during compact:**
```
Project: MyProject v2.40.0 | Branch: main

Active Stories:
- US-0042 (in-progress): Login API
- US-0043 (blocked): Payment Integration

WIP Count: 2/3
Context Preservation: ENABLED
```

**Requires:** Hooks System configured first

---

### 4. Status Line Configuration

**Purpose:** Configure a custom status bar in Claude Code

**Available components:**
- Current story ID and title
- Epic progress (X/Y stories)
- WIP count vs WIP limit
- Context usage percentage
- Session cost in USD
- Git branch name

**Example status lines:**
```
[Opus] US-0042: Login API | WIP 2/3 | 45% ctx | main
agileflow v2.40.0 | US-0003 | main
```

**Options:**
```
Display components:  story, epic, wip, context, cost, git (multiselect)
Show git branch:     Yes / No
```

**Important:** Requires Claude Code restart.

---

### 5. Archival Configuration

**Purpose:** Automatically manage status.json file size

**Why it matters:**
- status.json can exceed 25k token limit
- When too large, agents can't read it
- Auto-archival prevents this silently

**Threshold options:**
- **30 days** (recommended) - Balance between context and history
- **14 days** - Fast-moving projects
- **7 days** - Large teams with many stories
- **3 days** - Very aggressive, minimal status.json

**Archive structure:**
```
docs/09-agents/
â”œâ”€â”€ status.json           # Active work
â”œâ”€â”€ status-archive.json   # Historical
â””â”€â”€ archive/
    â”œâ”€â”€ 2025-01.json      # Monthly archives
    â””â”€â”€ 2025-02.json
```

**Manual commands:**
```bash
# Archive with default threshold
bash scripts/archive-completed-stories.sh

# Archive with custom threshold (days)
bash scripts/archive-completed-stories.sh 7

# Compress status.json (removes verbose fields)
bash scripts/compress-status.sh
```

---

### 6. Attribution Configuration

**Purpose:** Configure git commit attribution preferences

**Options:**
- **No attribution** (recommended): Clean commits without AI mentions
- **Keep attribution** (default): Include Claude Code footer

**Example CLAUDE.md with disabled attribution:**
```markdown
## CRITICAL: NO AI Attribution in Git Commits

âŒ FORBIDDEN:
- ðŸ¤– Generated with Claude Code
- Co-Authored-By: Claude

âœ… REQUIRED:
- Clean, professional commit messages
- Conventional commit format
```

---

### 7. CI/CD Configuration

**Purpose:** Set up continuous integration workflows

**Supported providers:**
- GitHub Actions (`.github/workflows/ci.yml`)
- GitLab CI (`.gitlab-ci.yml`)
- CircleCI (`.circleci/config.yml`)

**Configurable commands:**
- Install dependencies
- Run tests
- Run linter
- Run type checker
- Build project

**Options:**
```
CI provider:         GitHub Actions / GitLab CI / CircleCI
Commands to run:     install, test, lint, type-check, build (multiselect)
Test locally:        Yes / No
Trigger remote CI:   Yes / No
```

---

### 8. Damage Control Configuration

**Purpose:** Protect your codebase from destructive commands

See [Damage Control](/docs/features/damage-control) for full documentation.

**Protection levels:**
- **Standard** - Fast pattern matching, 40+ patterns
- **Enhanced** - Standard + AI evaluation
- **Minimal** - Path protection only

**Options:**
```
Protection level:    Standard / Enhanced / Minimal
Custom protections:  Prod DB / Cloud CLI / Env files (multiselect)
```

---

### 9. Verification Agent

**Purpose:** Test and validate configurations work correctly

**What it validates:**
- JSON file syntax (settings, metadata)
- Hook script execution
- YAML workflow syntax
- CI commands (local testing)
- Remote connections

**Token management:**
- Stores tokens in `.claude/settings.local.json` (gitignored)
- Supports GitHub, GitLab, CircleCI tokens
- Never echoes tokens to console

---

## File Organization

```
project/
â”œâ”€â”€ .github/workflows/ci.yml          # GitHub Actions
â”œâ”€â”€ .claude/
â”‚   â”œâ”€â”€ settings.json                 # Hooks & status line (committed)
â”‚   â”œâ”€â”€ settings.local.json           # User overrides (gitignored)
â”‚   â””â”€â”€ settings.local.example.json   # Template for team
â”œâ”€â”€ .agileflow/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ damage-control-patterns.yaml
â”‚   â””â”€â”€ scripts/
â”‚       â””â”€â”€ ...
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ agileflow-welcome.js
â”‚   â”œâ”€â”€ agileflow-statusline.sh
â”‚   â””â”€â”€ precompact-context.sh
â”œâ”€â”€ CLAUDE.md                         # Project guidelines
â””â”€â”€ docs/00-meta/
    â””â”€â”€ agileflow-metadata.json       # Configuration metadata
```

## Gitignore Rules

**Committed (team configuration):**
- `.claude/settings.json`
- `.claude/settings.local.example.json`
- `.github/workflows/`
- `CLAUDE.md`
- `scripts/`
- `.agileflow/`

**Gitignored (user-specific):**
- `.claude/settings.local.json`
- `.claude/prompt-log.txt`
- `.claude/*.log`

## Token Reference

### GitHub Token (ghp_xxx)
- **Location:** `.claude/settings.local.json`
- **Scopes needed:** `repo`, `workflow`
- **Create at:** https://github.com/settings/tokens/new

### GitLab Token (glpat_xxx)
- **Location:** `.claude/settings.local.json`
- **Scopes needed:** `api`, `read_repository`, `write_repository`
- **Create at:** https://gitlab.com/-/profile/personal_access_tokens

### CircleCI Token
- **Location:** `.claude/settings.local.json`
- **Create at:** https://app.circleci.com/settings/user/tokens

## Troubleshooting

| Problem | Cause | Solution |
|---------|-------|----------|
| Config not taking effect | Claude Code not restarted | Quit (Cmd+Q) and restart |
| Token auth fails | Expired/invalid token | Regenerate at provider |
| YAML syntax error | Invalid workflow file | Validate with yamllint |
| status.json too large | Exceeds token limit | Enable archival (3-7 days) |
| Hooks don't run | settings.json invalid | Check JSON with `jq` |
| Status line missing | Script not executable | `chmod +x scripts/*.sh` |

### Restart Requirement

These agents require **Claude Code restart**:
- hooks
- precompact
- status-line
- damage-control

```bash
# Complete quit (not just closing window)
Cmd+Q (Mac) or Ctrl+Q (Windows/Linux)
# Wait 5 seconds, then reopen
```

### Rollback

```bash
# Restore from git
git checkout .claude/settings.json

# Remove problematic hook
jq 'del(.hooks.HookName)' .claude/settings.json > tmp.json && mv tmp.json .claude/settings.json

# Disable all hooks
jq 'del(.hooks)' .claude/settings.json > tmp.json && mv tmp.json .claude/settings.json
```

## Common Scenarios

### Fresh Project Setup
```bash
/agileflow:configure  # Select: Git Repository
/agileflow:configure  # Select: Hooks System
/agileflow:configure  # Select: Damage Control
/agileflow:configure  # Select: Verification
```

### Add CI/CD
```bash
/agileflow:configure  # Select: CI/CD Workflow
# Choose provider, commands, test locally
git add .github/workflows/ci.yml
git commit -m "ci: add GitHub Actions workflow"
```

### Optimize for Large Projects
```bash
/agileflow:configure  # Select: Archival (7-14 days)
/agileflow:configure  # Select: Status Line
/agileflow:configure  # Select: PreCompact
```
