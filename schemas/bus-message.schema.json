{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://agileflow.dev/schemas/bus-message.json",
  "title": "AgileFlow Bus Message",
  "description": "Message format for agent coordination bus (log.jsonl)",
  "type": "object",
  "required": ["ts", "from", "type", "text"],
  "properties": {
    "ts": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when message was sent"
    },
    "from": {
      "type": "string",
      "description": "Agent ID that sent the message",
      "pattern": "^(MENTOR|AG-UI|AG-API|AG-CI|AG-DEVOPS|EPIC-PLANNER|ADR-WRITER|RESEARCH|[A-Za-z0-9_-]+)$"
    },
    "to": {
      "type": "string",
      "description": "Target agent ID or ALL for broadcast",
      "pattern": "^(ALL|MENTOR|AG-UI|AG-API|AG-CI|AG-DEVOPS|EPIC-PLANNER|ADR-WRITER|RESEARCH|[A-Za-z0-9_-]+)$"
    },
    "type": {
      "type": "string",
      "description": "Message type for coordination",
      "enum": [
        "status",
        "blocked",
        "unblock",
        "assign",
        "handoff",
        "question",
        "research-request",
        "research-complete",
        "dependency-resolved",
        "epic-created",
        "story-created",
        "adr-created",
        "pr-opened",
        "pr-merged"
      ]
    },
    "story": {
      "type": "string",
      "description": "Story ID this message relates to (if applicable)",
      "pattern": "^(US|EP)-[0-9]{4}$"
    },
    "epic": {
      "type": "string",
      "description": "Epic ID this message relates to (if applicable)",
      "pattern": "^EP-[0-9]{4}$"
    },
    "text": {
      "type": "string",
      "description": "Human-readable message content",
      "minLength": 1,
      "maxLength": 1000
    },
    "metadata": {
      "type": "object",
      "description": "Additional structured data (optional)",
      "additionalProperties": true
    }
  },
  "additionalProperties": false
}
